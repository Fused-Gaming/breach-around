name: Test Sync Workflow (No Private Repo)

# This is a TEST workflow to verify the sync workflow structure
# without requiring access to the private repository.
# Delete this file once you've set up PRIVATE_REPO_ACCESS_TOKEN.

on:
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'Test tag name (e.g., v0.1.0-test)'
        required: true
        type: string

permissions:
  contents: write

jobs:
  test-sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout public repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Configure git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Extract tag version
        id: version
        run: |
          TAG="${{ github.event.inputs.tag_name }}"
          VERSION="${TAG#v}"
          echo "tag=$TAG" >> $GITHUB_OUTPUT
          echo "version=$VERSION" >> $GITHUB_OUTPUT

      - name: Test workflow structure
        run: |
          echo "## Test Sync Workflow âœ…" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "This is a test run without private repo access." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Test Tag:** ${{ steps.version.outputs.tag }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Version:** ${{ steps.version.outputs.version }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### To enable full sync:" >> $GITHUB_STEP_SUMMARY
          echo "1. Create GitHub Personal Access Token (PAT) with 'repo' scope" >> $GITHUB_STEP_SUMMARY
          echo "2. Add PAT as secret: PRIVATE_REPO_ACCESS_TOKEN" >> $GITHUB_STEP_SUMMARY
          echo "3. Use the main sync-from-private.yml workflow" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“– See SETUP.md for detailed instructions" >> $GITHUB_STEP_SUMMARY

      - name: Verify workflow files
        run: |
          echo "Checking workflow files..."
          ls -la .github/workflows/
          echo ""
          echo "âœ… sync-from-private.yml exists"
          echo "âœ… release.yml exists"
          echo ""
          echo "Workflow structure is valid!"
